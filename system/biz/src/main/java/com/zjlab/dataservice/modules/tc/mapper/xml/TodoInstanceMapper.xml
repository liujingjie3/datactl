<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zjlab.dataservice.modules.tc.mapper.TodoInstanceMapper">

    <select id="selectTodoInstancePage" resultType="com.zjlab.dataservice.modules.tc.model.dto.TodoInstanceDto">
        select id, code, template_id, title, instance_name, instance_id, instance_type, from_user_id, template_code,
               instance_attr, flag, result, pc_url, h5_url,  create_on, corp_id, agent_id, ext, remark
        from tc_todo_instance
        where id in (SELECT MAX(id) from tc_todo_instance GROUP BY code)
    </select>

    <select id="selectOneByInstance" resultType="com.zjlab.dataservice.modules.tc.model.entity.TodoInstance" >
        SELECT id, code, template_id, title, instance_name, instance_id, instance_type, from_user_id, template_code,
        instance_attr, flag, result, pc_url, h5_url, create_on, corp_id, agent_id, ext, remark
        FROM tc_todo_instance
        <where>
            <if test="request.instanceId != null and request.instanceId != ''">
                and instance_id = #{request.instanceId}
            </if>
            <if test="request.code != null and request.code != ''">
                and code = #{request.code}
            </if>
            <if test="request.instanceName != null and request.instanceName != ''">
                and instance_name = #{request.instanceName}
            </if>
            <if test="request.flag != null">
                and flag = #{request.flag}
            </if>
            <if test="request.createBy != null and request.createBy != ''">
                and create_by = #{request.createBy}
            </if>
            <if test="request.corpId != null and request.corpId != ''">
                and corp_id = #{request.corpId}
            </if>
            <if test="request.agentId != null and request.agentId != ''">
                and agent_id = #{request.agentId}
            </if>
        </where>
        order by id desc
        limit 1
    </select>

</mapper>
