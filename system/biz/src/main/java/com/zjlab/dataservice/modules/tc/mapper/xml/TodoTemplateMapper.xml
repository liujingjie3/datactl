<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zjlab.dataservice.modules.tc.mapper.TodoTemplateMapper">

    <select id="selectTodoTemplatePage" resultType="com.zjlab.dataservice.modules.tc.model.dto.TodoTemplateDto">
        SELECT
        id,
        code,
        template_id,
        template_type,
        template_name,
        flag,
        remark,
        template_attr As attrs,
        corp_id,
        agent_id,
        ext,
        create_by,
        create_time,
        update_by,
        update_time
        FROM
        tc_todo_template
        WHERE
        del_flag = 0
        <if test="request.templateName != null and request.templateName != ''">
            AND template_name LIKE CONCAT('%', #{request.templateName}, '%')
        </if>

        <choose>
            <when test="request.orderByField != null and request.orderByField != ''">
                ORDER BY
                ${request.orderByField}
                <choose>
                    <when test="request.orderByType != null and request.orderByType.toLowerCase() == 'asc'">
                        ASC
                    </when>
                    <otherwise>
                        DESC
                    </otherwise>
                </choose>
            </when>
            <otherwise>
                ORDER BY update_time DESC
            </otherwise>
        </choose>
    </select>

    <select id="selectOneByTemplate" resultType="com.zjlab.dataservice.modules.tc.model.entity.TodoTemplate" parameterType="com.zjlab.dataservice.modules.tc.model.entity.TodoTemplate">
        SELECT id, code, template_id, template_type, template_name, flag, remark, template_attr, corp_id, agent_id
        FROM tc_todo_template
        where del_flag = 0
        <if test="templateName != null and templateName != ''">
            and template_name = #{templateName}
        </if>
        <if test="templateType != null and templateType != ''">
            and template_type = #{templateType}
        </if>
        <if test="templateId != null and templateId != ''">
            and template_id = #{templateId}
        </if>
        <if test="code != null and code != ''">
            and code = #{code}
        </if>
        <if test="createBy != null and createBy != ''">
            and create_by = #{createBy}
        </if>
        <if test="corpId != null and corpId != ''">
            and corp_id = #{corpId}
        </if>
        <if test="agentId != null and agentId != ''">
            and agent_id = #{agentId}
        </if>
        order by id desc
        limit 1
    </select>


</mapper>
